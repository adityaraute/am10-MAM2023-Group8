---
title: "Data Vis Group Project Allison"
author: "Jiayi Li"
date: "2023-11-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(scales)
library(plotly)
library(treemap)
library(readxl)
library(ggplot2)
```


```{r}
# Peek at the data
head(Twitch_global_data)

# Ensure that 'year' and 'Month' are in the correct format
Twitch_global_data$year <- as.integer(as.character(Twitch_global_data$year))
Twitch_global_data$Month <- as.integer(as.character(Twitch_global_data$Month))

# Calculate average viewer ratio for each year
yearly_avg_viewer_ratio <- Twitch_global_data %>%
  group_by(year) %>%
  summarise(AverageViewerRatio = mean(Viewer_ratio, na.rm = TRUE))

yearly_avg_viewer_ratio

skim(Twitch_global_data)
summary(Twitch_global_data$Viewer_ratio)
```


```{r}
# Calculate year-over-year changes
yearly_avg_viewer_ratio <- yearly_avg_viewer_ratio %>%
  arrange(year) %>%
  mutate(Change = (AverageViewerRatio - lag(AverageViewerRatio)) / lag(AverageViewerRatio) * 100)

yearly_avg_viewer_ratio

```

```{r average viewer ratio changes year over year}
library(ggplot2)
library(scales)  # For percent_format()

# Assuming 'yearly_avg_viewer_ratio' is a dataframe with 'Year' and 'Change' columns
# Plotting the year-over-year changes
ggplot(data = yearly_avg_viewer_ratio, aes(x = year, y = Change)) +
  geom_col(aes(fill = Change), show.legend = FALSE) +  # Use fill aesthetic for automatic color grading
  scale_fill_gradient2(low = "lightblue", high = "salmon", mid = "grey", midpoint = 0) +  # Gradient color scheme
  geom_text(aes(label = scales::percent(Change / 100, accuracy = .1)), position = position_stack(vjust = 0.5), color = "black", size = 3.5) +  # Add labels
  theme_minimal(base_size = 14) +  # Clean theme
  theme(
    axis.text.x = element_text(hjust = 1),  # Angle x-axis text
    plot.title = element_text(size = 16, face = "bold"),  # Bold title
    plot.subtitle = element_text(size = 12),  # Subtitle
    panel.grid.major = element_blank(),  # Remove major grid lines
    panel.grid.minor = element_blank(),  # Remove minor grid lines
    panel.background = element_blank()   # Remove panel background
  ) +
  labs(
    title = "Average Viewer Ratio Remains Steady",
    subtitle = "Yearly percentage changes in average viewer ratio",
    x = "Year",
    y = "Year-over-Year Change (%)"
  ) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "darkgrey")   # Reference line at 0%

```






```{r Viewers and Channels correlations }
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(readr)
library(lubridate)
library(scales)

# Assuming Twitch_global_data is your dataframe and it has columns for 'year', 'Month', 'Avg_viewers', 'Peak_viewers'

# Create a Date column from year and month
Twitch_global_data$Date <- make_date(Twitch_global_data$year, Twitch_global_data$Month)

# Create the plot with a more gentle color for the bars and smaller points for peak viewers
ggplot(Twitch_global_data, aes(x = Date)) +
  geom_bar(aes(y = Avg_viewers), stat = "identity", fill = "#AEC7E8", alpha = 0.7) + # Lighter blue color
  geom_point(aes(y = Peak_viewers), color = "orange", size = 2) + # Smaller points
  scale_x_date(labels = date_format("%Y"), breaks = date_breaks("1 year")) +
  scale_y_continuous(labels = comma) +
  labs(title = "Surging Popularity",
    subtitle = "Twitch's Rising Average and Peak Viewership Trends",
       x = "Year",
       y = "Viewers") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold"))+
  theme(
    axis.text.x = element_text(vjust = 0.5, hjust=1),
    panel.grid.major = element_blank(),  # Remove major grid lines
    panel.grid.minor = element_blank(),  # Remove minor grid lines
    panel.background = element_blank()   # Remove panel background
  )

```

```{r treemap}


```

